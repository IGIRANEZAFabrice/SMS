<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supplier Report - Supply Analysis</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --blue: #3b82f6;
        --blue-dark: #1e293b;
        --blue-mid: #334155;
        --blue-hover: #2563eb;
        --white: #fff;
        --light-bg: #f1f5f9;
        --gray-light: #cbd5e1;
        --gray-mid: #94a3b8;
        --gray-dark: #64748b;
        --gray-darker: #475569;
        --red: #ef4444;
        --green: #10b981;
        --orange: #f59e0b;
        --purple: #8b5cf6;
        --yellow: #fbbf24;
        --shadow-light: rgba(0, 0, 0, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--light-bg);
      }

      .page-header {
        background: var(--white);
        padding: 25px 30px;
        box-shadow: 0 2px 4px var(--shadow-light);
        margin-bottom: 30px;
      }

      .page-header h1 {
        font-size: 28px;
        color: var(--blue-dark);
        margin-bottom: 5px;
      }

      .page-header p {
        color: var(--gray-dark);
        font-size: 14px;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 30px 30px;
      }

      /* Filters */
      .filters-card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 1px 3px var(--shadow-light);
        padding: 25px;
        margin-bottom: 30px;
      }

      .filters-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        align-items: end;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        margin-bottom: 8px;
        color: var(--blue-dark);
        font-weight: 600;
        font-size: 14px;
      }

      .form-control {
        padding: 10px 14px;
        border: 2px solid var(--gray-light);
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
        outline: none;
        font-family: inherit;
      }

      .form-control:focus {
        border-color: var(--blue);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
      }

      select.form-control {
        cursor: pointer;
      }

      .btn {
        padding: 10px 24px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--blue);
        color: var(--white);
      }

      .btn-primary:hover {
        background: var(--blue-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }

      .btn-success {
        background: var(--green);
        color: var(--white);
      }

      .btn-success:hover {
        background: #059669;
      }

      /* Stats */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: var(--white);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px var(--shadow-light);
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .stat-icon.blue {
        background: #eff6ff;
        color: var(--blue);
      }

      .stat-icon.green {
        background: #f0fdf4;
        color: var(--green);
      }

      .stat-icon.orange {
        background: #fff7ed;
        color: var(--orange);
      }

      .stat-icon.purple {
        background: #f5f3ff;
        color: var(--purple);
      }

      .stat-content h3 {
        font-size: 26px;
        color: var(--blue-dark);
        margin-bottom: 4px;
      }

      .stat-content p {
        color: var(--gray-dark);
        font-size: 13px;
      }

      /* Cards */
      .card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 1px 3px var(--shadow-light);
        padding: 25px;
        margin-bottom: 25px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
      }

      .card-title {
        font-size: 20px;
        color: var(--blue-dark);
        font-weight: 600;
      }

      /* Supplier Cards Grid */
      .suppliers-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .supplier-card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 2px 8px var(--shadow-light);
        padding: 20px;
        transition: all 0.3s;
        cursor: pointer;
        border: 2px solid transparent;
      }

      .supplier-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px var(--shadow-light);
        border-color: var(--blue);
      }

      .supplier-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
      }

      .supplier-name {
        font-size: 18px;
        font-weight: 600;
        color: var(--blue-dark);
        margin-bottom: 5px;
      }

      .supplier-contact {
        font-size: 13px;
        color: var(--gray-dark);
      }

      .supplier-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-top {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        color: var(--white);
      }

      .badge-active {
        background: #d1fae5;
        color: #065f46;
      }

      .supplier-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      .mini-stat {
        text-align: center;
        padding: 12px;
        background: var(--light-bg);
        border-radius: 8px;
      }

      .mini-stat-value {
        font-size: 22px;
        font-weight: 700;
        color: var(--blue);
        margin-bottom: 4px;
      }

      .mini-stat-label {
        font-size: 11px;
        color: var(--gray-dark);
        text-transform: uppercase;
        font-weight: 600;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: var(--light-bg);
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: var(--blue-dark);
        font-size: 14px;
        border-bottom: 2px solid var(--gray-light);
      }

      th.text-right {
        text-align: right;
      }

      td {
        padding: 12px;
        border-bottom: 1px solid var(--gray-light);
        color: var(--gray-darker);
        font-size: 14px;
      }

      td.text-right {
        text-align: right;
      }

      tr:hover {
        background: var(--light-bg);
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-pending {
        background: #fef3c7;
        color: #92400e;
      }

      .badge-approved {
        background: #dbeafe;
        color: #1e40af;
      }

      .badge-received {
        background: #d1fae5;
        color: #065f46;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--gray-mid);
      }

      .empty-state i {
        font-size: 64px;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      .empty-state h3 {
        font-size: 20px;
        margin-bottom: 8px;
      }

      .item-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .item-image {
        width: 40px;
        height: 40px;
        background: var(--light-bg);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--blue);
        font-size: 18px;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--gray-light);
      }

      .tab-btn {
        padding: 12px 20px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--gray-dark);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        bottom: -2px;
      }

      .tab-btn:hover {
        color: var(--blue);
      }

      .tab-btn.active {
        color: var(--blue);
        border-bottom-color: var(--blue);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 0 15px 20px;
        }

        .page-header {
          padding: 20px 15px;
        }

        .page-header h1 {
          font-size: 22px;
        }

        .filters-grid {
          grid-template-columns: 1fr;
        }

        .stats-grid {
          grid-template-columns: 1fr;
        }

        .suppliers-grid {
          grid-template-columns: 1fr;
        }

        .table-container {
          overflow-x: scroll;
        }

        table {
          min-width: 800px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h1><i class="fas fa-truck-loading"></i> Supplier Report</h1>
      <p>Comprehensive supplier performance and supply analysis</p>
    </div>

    <div class="container">
      <!-- Filters -->
      <div class="filters-card">
        <div class="filters-grid">
          <div class="form-group">
            <label><i class="fas fa-calendar"></i> Date From</label>
            <input type="date" class="form-control" id="dateFrom" />
          </div>
          <div class="form-group">
            <label><i class="fas fa-calendar"></i> Date To</label>
            <input type="date" class="form-control" id="dateTo" />
          </div>
          <div class="form-group">
            <label><i class="fas fa-truck"></i> Supplier</label>
            <select class="form-control" id="supplierFilter">
              <option value="">All Suppliers</option>
            </select>
          </div>
          <div style="display: flex; gap: 10px;">
            <button class="btn btn-primary" onclick="applyFilters()">
              <i class="fas fa-filter"></i> Apply
            </button>
            <button class="btn btn-success" onclick="exportReport()">
              <i class="fas fa-file-excel"></i> Export
            </button>
          </div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon blue">
            <i class="fas fa-truck"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalSuppliers">0</h3>
            <p>Active Suppliers</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon green">
            <i class="fas fa-file-invoice"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalRequests">0</h3>
            <p>Purchase Requests</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon orange">
            <i class="fas fa-box"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalItems">0</h3>
            <p>Items Supplied</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon purple">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="stat-content">
            <h3 id="totalValue">$0.00</h3>
            <p>Total Supply Value</p>
          </div>
        </div>
      </div>

      <!-- Supplier Cards Overview -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Top Suppliers</h3>
        </div>
        <div class="suppliers-grid" id="suppliersGrid">
          <!-- Supplier cards will be inserted here -->
        </div>
      </div>

      <!-- Detailed Reports -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Detailed Supply Reports</h3>
        </div>

        <div class="tabs">
          <button class="tab-btn active" onclick="switchTab('purchase-requests')">
            <i class="fas fa-file-alt"></i> Purchase Requests
          </button>
          <button class="tab-btn" onclick="switchTab('stock-in')">
            <i class="fas fa-arrow-down"></i> Stock In History
          </button>
          <button class="tab-btn" onclick="switchTab('supplier-items')">
            <i class="fas fa-boxes"></i> Items by Supplier
          </button>
        </div>

        <!-- Purchase Requests Tab -->
        <div class="tab-content active" id="purchase-requestsTab">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Request ID</th>
                  <th>Supplier</th>
                  <th>Request Date</th>
                  <th>Items</th>
                  <th class="text-right">Total Quantity</th>
                  <th>Status</th>
                  <th>Created By</th>
                </tr>
              </thead>
              <tbody id="purchaseRequestsBody">
                <!-- Data will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Stock In History Tab -->
        <div class="tab-content" id="stock-inTab">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Item</th>
                  <th>Supplier</th>
                  <th class="text-right">Quantity</th>
                  <th class="text-right">Unit Price</th>
                  <th class="text-right">Total Value</th>
                  <th>Remark</th>
                </tr>
              </thead>
              <tbody id="stockInBody">
                <!-- Data will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Items by Supplier Tab -->
        <div class="tab-content" id="supplier-itemsTab">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Supplier</th>
                  <th>Item Name</th>
                  <th>Category</th>
                  <th>Unit</th>
                  <th class="text-right">Current Stock</th>
                  <th class="text-right">Unit Price</th>
                  <th class="text-right">Stock Value</th>
                </tr>
              </thead>
              <tbody id="supplierItemsBody">
                <!-- Data will be inserted here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sample data
      const suppliers = [
        { supplier_id: 1, supplier_name: "Tech Supply Co.", phone: "+250788123456", address: "Kigali" },
        { supplier_id: 2, supplier_name: "Hardware Solutions Ltd", phone: "+250788654321", address: "Kigali" },
        { supplier_id: 3, supplier_name: "Global Parts Inc.", phone: "+250788999888", address: "Kigali" }
      ];

      const categories = [
        { cat_id: 1, cat_name: "Electronics" },
        { cat_id: 2, cat_name: "Hardware" },
        { cat_id: 3, cat_name: "Tools" }
      ];

      const items = [
        { item_id: 1, item_name: "Laptop Battery", cat_id: 1, supplier_id: 1, item_unit: "PCS", price: 50.00, current_stock: 45 },
        { item_id: 2, item_name: "Screwdriver Set", cat_id: 3, supplier_id: 2, item_unit: "SET", price: 25.00, current_stock: 30 },
        { item_id: 3, item_name: "Power Supply", cat_id: 1, supplier_id: 1, item_unit: "PCS", price: 80.00, current_stock: 120 },
        { item_id: 4, item_name: "Wrench Set", cat_id: 3, supplier_id: 2, item_unit: "SET", price: 35.00, current_stock: 20 },
        { item_id: 5, item_name: "LED Light", cat_id: 1, supplier_id: 3, item_unit: "PCS", price: 15.00, current_stock: 80 }
      ];

      const users = [
        { user_id: 1, fullname: "John Doe" },
        { user_id: 2, fullname: "Jane Smith" }
      ];

      // Purchase requests
      const purchaseRequests = [
        { request_id: 1, supplier_id: 1, request_date: "2024-01-15", status: "received", created_by: 1, items: [1, 3], quantities: [50, 100] },
        { request_id: 2, supplier_id: 2, request_date: "2024-02-10", status: "approved", created_by: 2, items: [2, 4], quantities: [30, 20] },
        { request_id: 3, supplier_id: 3, request_date: "2024-03-05", status: "pending", created_by: 1, items: [5], quantities: [100] },
        { request_id: 4, supplier_id: 1, request_date: "2024-03-20", status: "received", created_by: 2, items: [1], quantities: [25] }
      ];

      // Stock in transactions (from tbl_progress)
      const stockInTransactions = [
        { prog_id: 1, item_id: 1, date: "2024-01-20", in_qty: 50, new_price: 50.00, remark: "Purchase order #1", created_by: 1 },
        { prog_id: 2, item_id: 3, date: "2024-01-20", in_qty: 100, new_price: 80.00, remark: "Purchase order #1", created_by: 1 },
        { prog_id: 3, item_id: 2, date: "2024-02-15", in_qty: 30, new_price: 25.00, remark: "Purchase order #2", created_by: 2 },
        { prog_id: 4, item_id: 5, date: "2024-03-10", in_qty: 100, new_price: 15.00, remark: "Purchase order #3", created_by: 1 },
        { prog_id: 5, item_id: 1, date: "2024-03-25", in_qty: 25, new_price: 50.00, remark: "Restock", created_by: 2 }
      ];

      // Initialize
      function init() {
        loadSupplierFilter();
        updateStatistics();
        loadSupplierCards();
        loadPurchaseRequests();
        loadStockInHistory();
        loadSupplierItems();
      }

      // Load supplier filter
      function loadSupplierFilter() {
        const select = document.getElementById("supplierFilter");
        suppliers.forEach(sup => {
          select.innerHTML += `<option value="${sup.supplier_id}">${sup.supplier_name}</option>`;
        });
      }

      // Update statistics
      function updateStatistics() {
        document.getElementById("totalSuppliers").textContent = suppliers.length;
        document.getElementById("totalRequests").textContent = purchaseRequests.length;
        document.getElementById("totalItems").textContent = items.length;

        const totalValue = stockInTransactions.reduce((sum, trans) => {
          return sum + (trans.in_qty * trans.new_price);
        }, 0);
        document.getElementById("totalValue").textContent = `$${totalValue.toFixed(2)}`;
      }

      // Load supplier cards
      function loadSupplierCards() {
        const grid = document.getElementById("suppliersGrid");
        grid.innerHTML = "";

        // Calculate stats for each supplier
        const supplierStats = suppliers.map(supplier => {
          const supplierItems = items.filter(item => item.supplier_id === supplier.supplier_id);
          const requests = purchaseRequests.filter(req => req.supplier_id === supplier.supplier_id);
          const stockIns = stockInTransactions.filter(trans => {
            const item = items.find(i => i.item_id === trans.item_id);
            return item && item.supplier_id === supplier.supplier_id;
          });

          const totalValue = stockIns.reduce((sum, trans) => sum + (trans.in_qty * trans.new_price), 0);

          return {
            ...supplier,
            itemCount: supplierItems.length,
            requestCount: requests.length,
            totalValue: totalValue
          };
        });

        // Sort by total value (top suppliers)
        supplierStats.sort((a, b) => b.totalValue - a.totalValue);

        supplierStats.forEach((supplier, index) => {
          const isTop = index < 3;
          const card = document.createElement("div");
          card.className = "supplier-card";
          card.innerHTML = `
            <div class="supplier-header">
              <div>
                <div class="supplier-name">${supplier.supplier_name}</div>
                <div class="supplier-contact">
                  <i class="fas fa-phone"></i> ${supplier.phone}<br>
                  <i class="fas fa-map-marker-alt"></i> ${supplier.address}
                </div>
              </div>
              ${isTop ? '<span class="supplier-badge badge-top"><i class="fas fa-star"></i> Top Supplier</span>' : '<span class="supplier-badge badge-active">Active</span>'}
            </div>
            <div class="supplier-stats">
              <div class="mini-stat">
                <div class="mini-stat-value">${supplier.itemCount}</div>
                <div class="mini-stat-label">Items</div>
              </div>
              <div class="mini-stat">
                <div class="mini-stat-value">${supplier.requestCount}</div>
                <div class="mini-stat-label">Requests</div>
              </div>
              <div class="mini-stat" style="grid-column: 1 / -1;">
                <div class="mini-stat-value">$${supplier.totalValue.toFixed(2)}</div>
                <div class="mini-stat-label">Total Supply Value</div>
              </div>
            </div>
          `;
          grid.appendChild(card);
        });
      }

      // Load purchase requests
      function loadPurchaseRequests() {
        const tbody = document.getElementById("purchaseRequestsBody");
        tbody.innerHTML = "";

        if (purchaseRequests.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-file-alt"></i><h3>No Purchase Requests</h3></div></td></tr>';
          return;
        }

        purchaseRequests.forEach(req => {
          const supplier = suppliers.find(s => s.supplier_id === req.supplier_id);
          const user = users.find(u => u.user_id === req.created_by);
          const totalQty = req.quantities.reduce((sum, q) => sum + q, 0);

          const statusBadge = req.status === "received" 
            ? '<span class="badge badge-received">Received</span>'
            : req.status === "approved"
            ? '<span class="badge badge-approved">Approved</span>'
            : '<span class="badge badge-pending">Pending</span>';

          tbody.innerHTML += `
            <tr>
              <td><strong>#PR${req.request_id.toString().padStart(4, '0')}</strong></td>
              <td>${supplier ? supplier.supplier_name : 'N/A'}</td>
              <td>${new Date(req.request_date).toLocaleDateString()}</td>
              <td>${req.items.length} item(s)</td>
              <td class="text-right"><strong>${totalQty}</strong></td>
              <td>${statusBadge}</td>
              <td>${user ? user.fullname : 'N/A'}</td>
            </tr>
          `;
        });
      }

      // Load stock in history
      function loadStockInHistory() {
        const tbody = document.getElementById("stockInBody");
        tbody.innerHTML = "";

        if (stockInTransactions.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-arrow-down"></i><h3>No Stock In Records</h3></div></td></tr>';
          return;
        }

        stockInTransactions.forEach(trans => {
          const item = items.find(i => i.item_id === trans.item_id);
          const supplier = item ? suppliers.find(s => s.supplier_id === item.supplier_id) : null;
          const totalValue = trans.in_qty * trans.new_price;

          tbody.innerHTML += `
            <tr>
              <td>${new Date(trans.date).toLocaleDateString()}</td>
              <td>
                <div class="item-row">
                  <div class="item-image"><i class="fas fa-box"></i></div>
                  <strong>${item ? item.item_name : 'N/A'}</strong>
                </div>
              </td>
              <td>${supplier ? supplier.supplier_name : 'N/A'}</td>
              <td class="text-right"><strong>${trans.in_qty}</strong> ${item ? item.item_unit : ''}</td>
              <td class="text-right">$${trans.new_price.toFixed(2)}</td>
              <td class="text-right"><strong>$${totalValue.toFixed(2)}</strong></td>
              <td>${trans.remark || 'N/A'}</td>
            </tr>
          `;
        });
      }

      // Load supplier items
      function loadSupplierItems() {
        const tbody = document.getElementById("supplierItemsBody");
        tbody.innerHTML = "";

        if (items.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-boxes"></i><h3>No Items Found</h3></div></td></tr>';
          return;
        }

        items.forEach(item => {
          const supplier = suppliers.find(s => s.supplier_id === item.supplier_id);
          const category = categories.find(c => c.cat_id === item.cat_id);
          const stockValue = item.current_stock * item.price;

          tbody.innerHTML += `
            <tr>
              <td>${supplier ? supplier.supplier_name : 'N/A'}</td>
              <td>
                <div class="item-row">
                  <div class="item-image"><i class="fas fa-box"></i></div>
                  <strong>${item.item_name}</strong>
                </div>
              </td>
              <td>${category ? category.cat_name : 'N/A'}</td>
              <td>${item.item_unit}</td>
              <td class="text-right"><strong>${item.current_stock}</strong></td>
              <td class="text-right">${item.price.toFixed(2)}</td>
              <td class="text-right"><strong>${stockValue.toFixed(2)}</strong></td>
            </tr>
          `;
        });
      }

      // Switch tabs
      function switchTab(tab) {
        const tabs = document.querySelectorAll(".tab-btn");
        const contents = document.querySelectorAll(".tab-content");

        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));

        event.target.closest(".tab-btn").classList.add("active");
        document.getElementById(tab + "Tab").classList.add("active");
      }

      // Apply filters
      function applyFilters() {
        const dateFrom = document.getElementById("dateFrom").value;
        const dateTo = document.getElementById("dateTo").value;
        const supplierId = document.getElementById("supplierFilter").value;

        // Filter logic here
        console.log("Filters applied:", { dateFrom, dateTo, supplierId });
        
        // You can implement filtering logic to filter the data arrays
        // Then reload the tables with filtered data
        
        // For now, just show a message
        alert("Filters applied! Connect this to your backend API to filter data.");
      }

      // Export report
      function exportReport() {
        let csv = "SUPPLIER REPORT\n\n";
        
        // Export Purchase Requests
        csv += "PURCHASE REQUESTS\n";
        csv += "Request ID,Supplier,Request Date,Items Count,Total Quantity,Status,Created By\n";
        purchaseRequests.forEach(req => {
          const supplier = suppliers.find(s => s.supplier_id === req.supplier_id);
          const user = users.find(u => u.user_id === req.created_by);
          const totalQty = req.quantities.reduce((sum, q) => sum + q, 0);
          csv += `PR${req.request_id.toString().padStart(4, '0')},"${supplier ? supplier.supplier_name : 'N/A'}","${req.request_date}",${req.items.length},${totalQty},"${req.status}","${user ? user.fullname : 'N/A'}"\n`;
        });

        csv += "\n\nSTOCK IN HISTORY\n";
        csv += "Date,Item,Supplier,Quantity,Unit Price,Total Value,Remark\n";
        stockInTransactions.forEach(trans => {
          const item = items.find(i => i.item_id === trans.item_id);
          const supplier = item ? suppliers.find(s => s.supplier_id === item.supplier_id) : null;
          const totalValue = trans.in_qty * trans.new_price;
          csv += `"${trans.date}","${item ? item.item_name : 'N/A'}","${supplier ? supplier.supplier_name : 'N/A'}",${trans.in_qty},${trans.new_price.toFixed(2)},${totalValue.toFixed(2)},"${trans.remark || ''}"\n`;
        });

        csv += "\n\nITEMS BY SUPPLIER\n";
        csv += "Supplier,Item Name,Category,Unit,Current Stock,Unit Price,Stock Value\n";
        items.forEach(item => {
          const supplier = suppliers.find(s => s.supplier_id === item.supplier_id);
          const category = categories.find(c => c.cat_id === item.cat_id);
          const stockValue = item.current_stock * item.price;
          csv += `"${supplier ? supplier.supplier_name : 'N/A'}","${item.item_name}","${category ? category.cat_name : 'N/A'}","${item.item_unit}",${item.current_stock},${item.price.toFixed(2)},${stockValue.toFixed(2)}\n`;
        });

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `supplier_report_${new Date().toISOString().slice(0, 10)}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
      }

      // Initialize on page load
      init();
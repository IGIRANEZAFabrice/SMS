<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Categories, Items & Opening Stock</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      :root {
        --blue: #3b82f6;
        --blue-dark: #1e293b;
        --blue-mid: #334155;
        --blue-hover: #2563eb;
        --white: #fff;
        --light-bg: #f1f5f9;
        --gray-light: #cbd5e1;
        --gray-mid: #94a3b8;
        --gray-dark: #64748b;
        --gray-darker: #475569;
        --red: #ef4444;
        --green: #10b981;
        --orange: #f59e0b;
        --shadow-light: rgba(0, 0, 0, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--light-bg);
      }

      .page-header {
        background: var(--white);
        padding: 25px 30px;
        box-shadow: 0 2px 4px var(--shadow-light);
        margin-bottom: 30px;
      }

      .page-header h1 {
        font-size: 28px;
        color: var(--blue-dark);
        margin-bottom: 5px;
      }

      .page-header p {
        color: var(--gray-dark);
        font-size: 14px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 30px 30px;
      }

      /* Tabs */
      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid var(--gray-light);
      }

      .tab-btn {
        padding: 12px 24px;
        background: none;
        border: none;
        border-bottom: 3px solid transparent;
        color: var(--gray-dark);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        bottom: -2px;
      }

      .tab-btn:hover {
        color: var(--blue);
      }

      .tab-btn.active {
        color: var(--blue);
        border-bottom-color: var(--blue);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Card */
      .card {
        background: var(--white);
        border-radius: 12px;
        box-shadow: 0 1px 3px var(--shadow-light);
        padding: 25px;
        margin-bottom: 25px;
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .card-title {
        font-size: 20px;
        color: var(--blue-dark);
        font-weight: 600;
      }

      /* Form */
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        display: flex;
        flex-direction: column;
      }

      .form-group label {
        margin-bottom: 8px;
        color: var(--blue-dark);
        font-weight: 500;
        font-size: 14px;
      }

      .form-group label .required {
        color: var(--red);
      }

      .form-control {
        padding: 10px 14px;
        border: 2px solid var(--gray-light);
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s;
        outline: none;
        font-family: inherit;
      }

      .form-control:focus {
        border-color: var(--blue);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
      }

      select.form-control {
        cursor: pointer;
      }

      textarea.form-control {
        resize: vertical;
        min-height: 80px;
      }

      .info-box {
        background: #eff6ff;
        border-left: 4px solid var(--blue);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .info-box i {
        color: var(--blue);
        margin-right: 8px;
      }

      .info-box p {
        color: var(--blue-dark);
        font-size: 14px;
        margin: 0;
      }

      .warning-box {
        background: #fff7ed;
        border-left: 4px solid var(--orange);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .warning-box i {
        color: var(--orange);
        margin-right: 8px;
      }

      .warning-box p {
        color: var(--gray-darker);
        font-size: 14px;
        margin: 0;
      }

      /* Buttons */
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--blue);
        color: var(--white);
      }

      .btn-primary:hover {
        background: var(--blue-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }

      .btn-success {
        background: var(--green);
        color: var(--white);
      }

      .btn-success:hover {
        background: #059669;
      }

      .btn-danger {
        background: var(--red);
        color: var(--white);
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 13px;
      }

      /* Table */
      .table-container {
        overflow-x: auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th {
        background: var(--light-bg);
        padding: 12px;
        text-align: left;
        font-weight: 600;
        color: var(--blue-dark);
        font-size: 14px;
        border-bottom: 2px solid var(--gray-light);
      }

      td {
        padding: 12px;
        border-bottom: 1px solid var(--gray-light);
        color: var(--gray-darker);
        font-size: 14px;
      }

      tr:hover {
        background: var(--light-bg);
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-success {
        background: #d1fae5;
        color: #065f46;
      }

      .badge-danger {
        background: #fee2e2;
        color: #991b1b;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--gray-mid);
      }

      .empty-state i {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .container {
          padding: 0 15px 20px;
        }

        .page-header {
          padding: 20px 15px;
        }

        .page-header h1 {
          font-size: 22px;
        }

        .card {
          padding: 20px;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }

        .table-container {
          overflow-x: scroll;
        }

        table {
          min-width: 700px;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-header">
      <h1><i class="fas fa-plus-circle"></i> Add Items & Categories</h1>
      <p>Manage categories, items, and opening stock</p>
    </div>

    <div class="container">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('categories')">
          <i class="fas fa-tags"></i> Categories
        </button>
        <button class="tab-btn" onclick="switchTab('items')">
          <i class="fas fa-box"></i> Items
        </button>
        <button class="tab-btn" onclick="switchTab('opening-stock')">
          <i class="fas fa-warehouse"></i> Opening Stock
        </button>
      </div>

      <!-- Categories Tab -->
      <div class="tab-content active" id="categoriesTab">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Add New Category</h3>
          </div>
          <form id="addCategoryForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Category Name <span class="required">*</span></label>
                <input
                  type="text"
                  class="form-control"
                  id="catName"
                  placeholder="Enter category name"
                  required
                />
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Description</label>
                <textarea
                  class="form-control"
                  id="catDescription"
                  placeholder="Enter category description (optional)"
                ></textarea>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> Add Category
            </button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Categories List</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Category Name</th>
                  <th>Description</th>
                  <th>Created At</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="categoriesTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Items Tab -->
      <div class="tab-content" id="itemsTab">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Add New Item</h3>
          </div>
          <form id="addItemForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Item Name <span class="required">*</span></label>
                <input
                  type="text"
                  class="form-control"
                  id="itemName"
                  placeholder="Enter item name"
                  required
                />
              </div>
              <div class="form-group">
                <label>Category <span class="required">*</span></label>
                <select class="form-control" id="itemCategory" required>
                  <option value="">Select category</option>
                </select>
              </div>
              <div class="form-group">
                <label>Supplier <span class="required">*</span></label>
                <select class="form-control" id="itemSupplier" required>
                  <option value="">Select supplier</option>
                </select>
              </div>
              <div class="form-group">
                <label>Unit <span class="required">*</span></label>
                <input
                  type="text"
                  class="form-control"
                  id="itemUnit"
                  placeholder="e.g., PCS, KG, LITER"
                  required
                />
              </div>
              <div class="form-group">
                <label>Price <span class="required">*</span></label>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="itemPrice"
                  placeholder="0.00"
                  required
                />
              </div>
              <div class="form-group">
                <label>Status <span class="required">*</span></label>
                <select class="form-control" id="itemStatus" required>
                  <option value="1">Active</option>
                  <option value="0">Inactive</option>
                </select>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-plus"></i> Add Item
            </button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Items List</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Item Name</th>
                  <th>Category</th>
                  <th>Unit</th>
                  <th>Price</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="itemsTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Opening Stock Tab -->
      <div class="tab-content" id="opening-stockTab">
        <div class="warning-box">
          <i class="fas fa-exclamation-triangle"></i>
          <p><strong>Important:</strong> Opening stock can only be added for NEW items that have no transactions in the system. If an item already has transactions, you cannot add opening stock.</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Add Opening Stock</h3>
          </div>
          <form id="addOpeningStockForm">
            <div class="form-grid">
              <div class="form-group">
                <label>Select Item <span class="required">*</span></label>
                <select class="form-control" id="stockItem" required onchange="checkItemTransactions()">
                  <option value="">Select an item</option>
                </select>
              </div>
              <div class="form-group">
                <label>Opening Quantity <span class="required">*</span></label>
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="stockQty"
                  placeholder="0.00"
                  required
                />
              </div>
            </div>
            <div id="stockWarning" class="info-box" style="display: none;">
              <i class="fas fa-info-circle"></i>
              <p id="stockWarningText"></p>
            </div>
            <button type="submit" class="btn btn-primary" id="submitStockBtn">
              <i class="fas fa-save"></i> Add Opening Stock
            </button>
          </form>
        </div>

        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Items with Opening Stock</h3>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Item ID</th>
                  <th>Item Name</th>
                  <th>Opening Quantity</th>
                  <th>Unit</th>
                  <th>Date Added</th>
                </tr>
              </thead>
              <tbody id="openingStockTableBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Sample data
      let categories = [
        { cat_id: 1, cat_name: "Electronics", description: "Electronic items", created_at: "2024-01-15 10:30:00" },
        { cat_id: 2, cat_name: "Hardware", description: "Hardware tools", created_at: "2024-02-20 14:45:00" }
      ];

      let suppliers = [
        { supplier_id: 1, supplier_name: "Tech Supply Co." },
        { supplier_id: 2, supplier_name: "Hardware Solutions Ltd" }
      ];

      let items = [
        { item_id: 1, item_name: "Laptop Battery", cat_id: 1, supplier_id: 1, item_unit: "PCS", price: 50.00, item_status: 1, has_transactions: true },
        { item_id: 2, item_name: "Screwdriver Set", cat_id: 2, supplier_id: 2, item_unit: "SET", price: 25.00, item_status: 1, has_transactions: false }
      ];

      let stock = [
        { stock_id: 1, item_id: 1, qty: 45, last_update: "2024-01-20 08:00:00" }
      ];

      // Tab switching
      function switchTab(tab) {
        const tabs = document.querySelectorAll(".tab-btn");
        const contents = document.querySelectorAll(".tab-content");

        tabs.forEach(t => t.classList.remove("active"));
        contents.forEach(c => c.classList.remove("active"));

        event.target.closest(".tab-btn").classList.add("active");
        document.getElementById(tab + "Tab").classList.add("active");
      }

      // Load dropdowns
      function loadDropdowns() {
        // Category dropdown
        const catSelect = document.getElementById("itemCategory");
        catSelect.innerHTML = '<option value="">Select category</option>';
        categories.forEach(cat => {
          catSelect.innerHTML += `<option value="${cat.cat_id}">${cat.cat_name}</option>`;
        });

        // Supplier dropdown
        const suppSelect = document.getElementById("itemSupplier");
        suppSelect.innerHTML = '<option value="">Select supplier</option>';
        suppliers.forEach(sup => {
          suppSelect.innerHTML += `<option value="${sup.supplier_id}">${sup.supplier_name}</option>`;
        });

        // Stock item dropdown (only items without transactions)
        const stockSelect = document.getElementById("stockItem");
        stockSelect.innerHTML = '<option value="">Select an item</option>';
        items.filter(item => !item.has_transactions).forEach(item => {
          stockSelect.innerHTML += `<option value="${item.item_id}">${item.item_name} (${item.item_unit})</option>`;
        });
      }

      // Load categories table
      function loadCategories() {
        const tbody = document.getElementById("categoriesTableBody");
        tbody.innerHTML = "";

        if (categories.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-tags"></i><p>No categories found</p></div></td></tr>';
          return;
        }

        categories.forEach(cat => {
          tbody.innerHTML += `
            <tr>
              <td>${cat.cat_id}</td>
              <td><strong>${cat.cat_name}</strong></td>
              <td>${cat.description || '<span style="color: var(--gray-mid)">N/A</span>'}</td>
              <td>${cat.created_at}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-primary" onclick="editCategory(${cat.cat_id})">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteCategory(${cat.cat_id})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        });
      }

      // Load items table
      function loadItems() {
        const tbody = document.getElementById("itemsTableBody");
        tbody.innerHTML = "";

        if (items.length === 0) {
          tbody.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-box"></i><p>No items found</p></div></td></tr>';
          return;
        }

        items.forEach(item => {
          const cat = categories.find(c => c.cat_id === item.cat_id);
          const status = item.item_status === 1 
            ? '<span class="badge badge-success">Active</span>'
            : '<span class="badge badge-danger">Inactive</span>';

          tbody.innerHTML += `
            <tr>
              <td>${item.item_id}</td>
              <td><strong>${item.item_name}</strong></td>
              <td>${cat ? cat.cat_name : 'N/A'}</td>
              <td>${item.item_unit}</td>
              <td>$${item.price.toFixed(2)}</td>
              <td>${status}</td>
              <td>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-primary" onclick="editItem(${item.item_id})">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.item_id})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          `;
        });
      }

      // Load opening stock table
      function loadOpeningStock() {
        const tbody = document.getElementById("openingStockTableBody");
        tbody.innerHTML = "";

        if (stock.length === 0) {
          tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-warehouse"></i><p>No opening stock records</p></div></td></tr>';
          return;
        }

        stock.forEach(s => {
          const item = items.find(i => i.item_id === s.item_id);
          if (item) {
            tbody.innerHTML += `
              <tr>
                <td>${item.item_id}</td>
                <td><strong>${item.item_name}</strong></td>
                <td>${s.qty}</td>
                <td>${item.item_unit}</td>
                <td>${s.last_update}</td>
              </tr>
            `;
          }
        });
      }

      // Check if item has transactions
      function checkItemTransactions() {
        const itemId = parseInt(document.getElementById("stockItem").value);
        const warning = document.getElementById("stockWarning");
        const warningText = document.getElementById("stockWarningText");
        const submitBtn = document.getElementById("submitStockBtn");

        if (!itemId) {
          warning.style.display = "none";
          submitBtn.disabled = false;
          return;
        }

        const item = items.find(i => i.item_id === itemId);
        
        if (item && item.has_transactions) {
          warning.style.display = "block";
          warning.style.background = "#fee2e2";
          warning.style.borderLeftColor = "var(--red)";
          warningText.innerHTML = '<strong>Error:</strong> This item already has transactions. Opening stock cannot be added.';
          submitBtn.disabled = true;
        } else {
          warning.style.display = "block";
          warning.style.background = "#eff6ff";
          warning.style.borderLeftColor = "var(--blue)";
          warningText.innerHTML = '<strong>Valid:</strong> This is a new item. You can add opening stock.';
          submitBtn.disabled = false;
        }
      }

      // Add Category
      document.getElementById("addCategoryForm").addEventListener("submit", (e) => {
        e.preventDefault();
        const name = document.getElementById("catName").value.trim();
        const desc = document.getElementById("catDescription").value.trim();

        const newCat = {
          cat_id: categories.length > 0 ? Math.max(...categories.map(c => c.cat_id)) + 1 : 1,
          cat_name: name,
          description: desc,
          created_at: new Date().toISOString().slice(0, 19).replace('T', ' ')
        };

        categories.push(newCat);
        loadCategories();
        loadDropdowns();
        document.getElementById("addCategoryForm").reset();

        Swal.fire({
          icon: "success",
          title: "Category Added!",
          timer: 2000,
          showConfirmButton: false
        });
      });

      // Add Item
      document.getElementById("addItemForm").addEventListener("submit", (e) => {
        e.preventDefault();
        
        const newItem = {
          item_id: items.length > 0 ? Math.max(...items.map(i => i.item_id)) + 1 : 1,
          item_name: document.getElementById("itemName").value.trim(),
          cat_id: parseInt(document.getElementById("itemCategory").value),
          supplier_id: parseInt(document.getElementById("itemSupplier").value),
          item_unit: document.getElementById("itemUnit").value.trim(),
          price: parseFloat(document.getElementById("itemPrice").value),
          item_status: parseInt(document.getElementById("itemStatus").value),
          has_transactions: false
        };

        items.push(newItem);
        loadItems();
        loadDropdowns();
        document.getElementById("addItemForm").reset();

        Swal.fire({
          icon: "success",
          title: "Item Added!",
          text: "You can now add opening stock for this item",
          timer: 2000,
          showConfirmButton: false
        });
      });

      // Add Opening Stock
      document.getElementById("addOpeningStockForm").addEventListener("submit", (e) => {
        e.preventDefault();
        
        const itemId = parseInt(document.getElementById("stockItem").value);
        const qty = parseFloat(document.getElementById("stockQty").value);
        const item = items.find(i => i.item_id === itemId);

        if (!item || item.has_transactions) {
          Swal.fire({
            icon: "error",
            title: "Cannot Add Stock",
            text: "This item already has transactions"
          });
          return;
        }

        const newStock = {
          stock_id: stock.length > 0 ? Math.max(...stock.map(s => s.stock_id)) + 1 : 1,
          item_id: itemId,
          qty: qty,
          last_update: new Date().toISOString().slice(0, 19).replace('T', ' ')
        };

        stock.push(newStock);
        item.has_transactions = true; // Mark as having transactions
        loadOpeningStock();
        loadDropdowns();
        document.getElementById("addOpeningStockForm").reset();
        document.getElementById("stockWarning").style.display = "none";

        Swal.fire({
          icon: "success",
          title: "Opening Stock Added!",
          timer: 2000,
          showConfirmButton: false
        });
      });

      // Edit/Delete functions (simplified)
      function editCategory(id) {
        Swal.fire({ icon: "info", title: "Edit Category", text: "Edit functionality - connect to your API" });
      }

      function deleteCategory(id) {
        Swal.fire({ icon: "warning", title: "Delete Category", text: "Delete functionality - connect to your API" });
      }

      function editItem(id) {
        Swal.fire({ icon: "info", title: "Edit Item", text: "Edit functionality - connect to your API" });
      }

      function deleteItem(id) {
        Swal.fire({ icon: "warning", title: "Delete Item", text: "Delete functionality - connect to your API" });
      }

      // Initialize
      loadDropdowns();
      loadCategories();
      loadItems();
      loadOpeningStock();
    </script>
  </body>
</html>